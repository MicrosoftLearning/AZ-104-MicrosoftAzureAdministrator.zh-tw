---
lab:
  title: 實驗室 10：實作資料保護
  module: Administer Data Protection
---

# 實驗 10 - 實作資料保護

## 實驗室簡介    

在本實驗室中，您將了解 Azure 虛擬機器的備份和復原。 您將了解如何建立復原服務保存庫和 Azure 虛擬機器的備份原則。 您將了解 Azure Site Recovery 的災害復原。 

本實驗室需有 Azure 訂閱。 您的訂閱類型可能會影響此實驗室中的功能可用性。 您可以變更區域，但這些步驟是以**美國東部**和**美國西部**為使用區域撰寫而成。

## 預估時間：50 分鐘

## 實驗案例

您的組織正在評估如何備份 Azure 虛擬機器以及還原因意外或惡意而遺失資料的機器。 此外，組織想要探索使用 Azure Site Recovery 進行災害復原的案例。 

## 互動式實驗室模擬

>**注意**：先前提供的實驗室模擬已淘汰。

## 作業技能

+ 工作 1：使用範本佈建基礎結構。
+ 工作 2：建立並設定復原服務保存庫。
+ 工作 3：設定 Azure 虛擬機器級備份。
+ 工作 4：監視 Azure 備份。
+ 工作 5：啟用虛擬機器複寫。 

## 預估時間：40 分鐘

## 架構圖

![結構工作圖表。](../media/az104-lab10-architecture.png)

## 工作 1：使用範本佈建基礎結構

在這項工作中，您會使用範本部署虛擬機器。 此虛擬機器會用來測試不同的備份案例。

1. 下載 **\\Allfiles\\Lab10\\** 實驗室檔案。

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 `Deploy a custom template`。

1. 在 [自訂部署] 頁面上，選取 [在編輯器中建置您自己的範本]****。

1. 在 [編輯範本] 頁面上，選取 [載入檔案]****。

1. 找到並選取 **\\Allfiles\\Lab10\\az104-10-vms-edge-template.json** 檔案，然後選取 [開啟]****。

   >**注意：** 花一點時間檢閱此範本。 我們要部署虛擬網路和虛擬機，以便示範備份和復原。 

1. **儲存**您的變更。

1. 選取 [編輯參數]****，然後 [載入檔案]****。

1. 載入並選取 **\\Allfiles\\Lab10\\az104-10-vms-edge-parameters.json** 檔案。

1. **儲存**您的變更。

1. 使用下列資訊填寫 [自訂部署] 頁面上的欄位，所有其他欄位都保留預設值:

    | 設定       | 值         | 
    | ---           | ---           |
    | 訂用帳戶  | 您的 Azure 訂用帳戶 |
    | 資源群組| `az104-rg-region1` (如有必要，請選取 [新建]****)
    | 區域        | **美國東部**   |
    | 使用者名稱      | **localadmin**   |
    | 密碼      | 輸入複雜密碼 |

1. 選取 **[檢閱 + 建立]**,然後選取 **[建立]**。

    >**注意：** 等候範本部署，然後選取 [前往資源]****。 一個虛擬網路應有一部虛擬機器。 

## 工作 2：建立並設定復原服務保存庫

在此工作中，您將建立復原服務保存庫。 復原服務保存庫會儲存虛擬機資料。 

1. 在 Azure 入口網站中，搜尋並選取 [`Recovery Services vaults`]，然後在 [復原服務保存庫]**** 刀鋒視窗上，按一下 [+ 建立]****。

1. 在 [建立復原服務保存庫] 刀鋒視窗上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶 | 您的 Azure 訂用帳戶的名稱 |
    | 資源群組 | `az104-rg-region1`  |
    | 保存庫名稱 | `az104-rsv-region1` |
    | 區域 | **美國東部** |

    >**注意**：請確定指定與在上一項工作中部署虛擬機器的相同區域。

    ![恢復服務資源庫的螢幕擷取畫面。](../media/az104-lab10-create-rsv.png)

1. 按一下 [檢閱 + 建立]****，確定通過驗證後，按一下 [建立]****。

    >**注意**：等待部署完成。 部署可能需要幾分鐘。 

1. 部署完成後，按一下 [前往資源]。

1. 在 [設定]** 區**段中，按兩下 [**屬性**]。

1. 選取 [備份設定]**** 標籤下的 [更新]**** 連結。

1. 在 [備份設定]**** 刀鋒視窗中，檢閱所選的**儲存體複寫類型**。 保留 [異地備援] 的預設設定，並關閉刀鋒視窗。

    >**注意**：此設定只有在無現有備份項目時才能設定。
    
    >**您知道嗎?** 跨區域還原選項讓您能夠在次要區域的 [Azure 配對區域](https://learn.microsoft.com/azure/backup/backup-create-recovery-services-vault#set-cross-region-restore)中還原資料。 

1. 選取 [安全性設定] 底下的 [**更新**] 連結，>虛刪除和安全性設定**標籤。**

1. 請注意，在 [安全性設定] 刀鋒視窗上，針對在 Azure 中執行的工作負載，[虛刪除] 為 [啟用]。 請注意，**虛刪除保留期間**為 **14** 天。 

>**您知道嗎?** Azure 有兩種保存庫:復原服務保存庫和備份保存庫。 主要差異在於可以備份的資料來源。 深入了解這些[差異](https://learn.microsoft.com/answers/questions/405915/what-is-difference-between-recovery-services-vault)。

## 工作 3：設定 Azure 虛擬機器層級的備份

在此工作中，您將實作 Azure 虛擬機器層級備份。 在 VM 備份中，您必須定義適用於備份的備份和保留原則。 您可為不同的 VM 指派不同的備份和保留原則。

   >**注意**：開始這項工作之前，請確定您在此實驗室第一個工作中起始的部署已成功完成。

1. 在 [復原服務保存庫] 刀鋒視窗上，按一下 [概觀]****，然後按一下 [+ 備份]****。

1. 在 [備份目標] 刀鋒視窗上，指定以下設定：

    | 設定 | 值 |
    | --- | --- |
    | 您的工作負載在哪裡執行？ | **Azure** (請注意其他選項) |
    | 您要備份什麼內容？ | **虛擬機器** (請注意其他選項) |

1. 選取 [備份]****。

1. 請注意，有兩種**原則子類型**:**增強**和**標準**。 檢閱選項，然後選取 [標準]****。 

1. 在 [備份原則]**** 中，選取 [建立新原則]****。

1. 使用下列設定定義新的備份原則 (將其他設定保留預設值)：

    | 設定 | 值 |
    | ---- | ---- |
    | 原則名稱 | `az104-backup` |
    | 頻率 | **每日** |
    | 時間 | **上午 12:00** |
    | 時區 | 當地時區的名稱 |
    | 保留立即復原快照集 | **2** 天 |

    ![螢幕擷取畫面: 備份原則頁面。](../media/az104-lab10-backup-policy.png)

1. 單擊 **[確定**] 以建立原則，**然後在 [虛擬機器**] 區段中，選取 [**新增**] （向下捲動）。

1. 在 [選取虛擬機器]**** 刀鋒視窗中，選取 [az-104-10-vm0]****，按一下 [確定]****，返回 [備份]**** 刀鋒視窗，按一下 [啟用備份]****。

    >**注意**：請等候備份完成啟用。 約需 2 分鐘。

1. 部署之後，選取 [前往資源]****。
   
1. 在 [受保護的項目]**** 區段中，按一下 [備份項目]****，然後按一下 [Azure 虛擬機器]**** 項目。

1. 選取 **az104-10-vm0** 的 [檢視詳細資料]**** 連結，檢閱 [備份檢查前]**** 和 [上次備份狀態]**** 項目的值。

    >**注意：** 請注意，備份正擱置。
    
1. 選取 [立即備份]****，接受 [保留備份到]**** 下拉式清單中的預設值，然後按一下 [確定]****。

    >**注意**：不必等待備份完成，直接繼續進行下一個工作。

## 工作 4：監視 Azure 備份

在這項工作中，您會部署 Azure 儲存體帳戶。 接著，您會設定保存庫，將記錄和計量傳送至記憶體帳戶。 然後，此存放庫可與 Log Analytics 或其他第三方監視解決方案搭配使用。

1. 在 Azure 入口網站中搜尋並選取 [`Storage accounts`]。

1. 在 [儲存體帳戶] 頁面上，選取 [建立]****。

1. 使用下列資訊來定義記憶體帳戶，然後選取 [ **檢閱 + 建立**]。

    | 設定 | 值 |
    | --- | --- | 
    | 訂用帳戶          | *您的訂用帳戶*    |
    | 資源群組        | **az104-rg-region1**        |
    | 儲存體帳戶名稱  | 提供全域唯一名稱   |
    | 區域                | **美國東部**   |

1. 選取 **建立**。

    >**注意**：等待部署完成。 應該需要 1 分鐘的時間。

1. 搜尋並選取您的復原服務保存庫。

1. 在 [ **監視]** 刀鋒視窗中，選取 [ **診斷設定** ]，然後選取 [ **新增診斷設定**]。

1. 將設定命名為 `Logs and Metrics to storage`。

1. 勾選下列記錄和計量類別:

    - **Azure 備份報告資料**
    - **附加元件 Azure 備份作業資料**
    - **附加元件 Azure 備份警示資料**
    - **Azure Site Recovery 作業**
    - **Azure Site Recovery 事件**

1. 在 [目的地詳細資料] 中，勾選 [封存至儲存體帳戶]****。

1. 在 [儲存體帳戶] 下拉式欄位中，選取稍早在此工作中部署的儲存體帳戶。

1. 選取 [儲存]。

1. 返回復原服務保存庫，在 [監視]**** 刀鋒視窗中，選取 [備份作業]****。

1. 找到 **az104-10-vm0** 虛擬機器的備份作業。 

1. **檢視備份作業之連結的右側詳細數據** （卷動至右側）。

## 工作 5：啟用虛擬機器複寫

1. 在 Azure 入口網站中，搜尋並選取 [`Recovery Services vaults`]，然後在 [復原服務保存庫]**** 刀鋒視窗上，按一下 [+ 建立]****。

1. 在 [建立復原服務保存庫] 刀鋒視窗上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶 | 您的 Azure 訂用帳戶的名稱 |
    | 資源群組 | `az104-rg-region2` (如有必要，請選取 **[新建]**) |
    | 保存庫名稱 | `az104-rsv-region2` |
    | 區域 | **美國西部** |

    >**注意**：請務必指定和虛擬機器**不同的**區域。

1. 按一下 [檢閱 + 建立]****，確定通過驗證後，按一下 [建立]****。

    >**注意**：等待部署完成。 部署可能需要幾分鐘。 

1. 搜尋並選取 `az104-10-vm0` 虛擬機器。

1. 在 [備份 + 災害復原]**** 刀鋒視窗中，選取 [災害復原]****。 

1. 注意 [基本]**** 索引標籤上的 [目標區域]****。

1. 選取 [下一步：進階設定]。**** 已為您選取資源。 

1. 向下捲動並 **建立** 自動化帳戶。 

   >**注意：** 請務必填入設定，否則驗證將會失敗。 

1. 依序選取 [檢閱 + 開始複寫]**** 和 [啟用複寫]****。

    >**注意**：啟用複寫需要 10-15 分鐘。 請留意入口網站右上方的通知訊息。 在等待時，請考慮閱讀本頁結尾處的自學型訓練連結。
    
1. 複寫完成後，請搜尋並找到復原服務保存庫 **az104-rsv-region2**。 您可能需要**重新整理**頁面。 

1. 在 [受保護的項目]**** 區段中選取 [複寫的項目]****。

1. 檢查虛擬機器的複寫健康情況是否顯示為良好。 請注意，狀態會顯示同步處理狀態 (從 0% 開始)，最後會在初始同步處理完成後顯示**受到保護**。

   ![螢幕擷取畫面: 複寫項目頁面。](../media/az104-lab10-replicated-items.png)

1. 選取虛擬機器以檢視更多詳細資料。
   
>**您知道嗎?** 建議[測試受保護 VM 的容錯移轉](https://learn.microsoft.com/azure/site-recovery/tutorial-dr-drill-azure#run-a-test-failover-for-a-single-vm)。

## 清除您的資源

如果您使用**自己的訂用帳戶**，請花點時間刪除實驗室資源。 如此可確保釋出資源，並將成本降到最低。 刪除實驗室資源的最簡單方式是刪除實驗室資源群組。 

+ 在 Azure 入口網站中，選取資源群組，選取 [刪除資源群組]****，[輸入資源群組名稱]****，然後按一下 [刪除]****。
+ 使用 Azure PowerShell `Remove-AzResourceGroup -Name resourceGroupName`。
+ 使用 CLI `az group delete --name resourceGroupName`。

## 利用 Copilot 延伸學習
Copilot 可協助您了解如何使用 Azure 指令碼工具。 Copilot 也可在實驗室中未涵蓋的區域或您需要更多資訊的地方提供協助。 開啟 Edge 瀏覽器，然後選擇 [Copilot] (右上方)，或瀏覽至 *copilot.microsoft.com*。 請花一點時間嘗試下列提示。

+ Azure 備份支援哪些產品?
+ 摘要說明使用 Azure 備份來備份和還原 Azure 虛擬機器的步驟。
+ 如何使用 Azure PowerShell 或 CLI 來檢查 Azure 備份作業的狀態?
+ 請提供至少五個設定 Azure 虛擬機器備份的最佳做法。  

## 透過自學型訓練深入了解

+ [使用 Azure 備份保護您的虛擬機器](https://learn.microsoft.com/training/modules/protect-virtual-machines-with-azure-backup/)。 使用 Azure 備份來協助保護內部部署伺服器、虛擬機器、SQL Server、Azure 檔案共用和其他工作負載。
+ [使用 Azure Site Recovery 來保護您的 Azure 基礎結構](https://learn.microsoft.com/en-us/training/modules/protect-infrastructure-with-site-recovery/)。 使用 Azure Site Recovery 自訂 Azure 虛擬機器的複寫、容錯移轉及容錯回復，藉以執行 Azure 基礎結構的災害復原。

## 重要心得

恭喜您完成此實驗室。 以下是本實驗室的主要重點。 

+ Azure 備份服務提供簡單、安全且符合成本效益的解決方案，備份及復原您的資料。
+ Azure 備份可以保護內部部署和雲端資源，包括虛擬機器和檔案共用。
+ Azure 備份原則會設定備份頻率和復原點的保留期間。 
+ Azure Site Recovery 是災害復原解決方案，可為虛擬機器和應用程式提供保護。
+ Azure Site Recovery 會將工作負載複寫至次要站台，並在發生中斷或災害時，容錯移轉至次要站台，以盡可能短的停機時間繼續作業。
+ 復原服務保存庫會儲存備份資料，並將管理負荷降至最低。
