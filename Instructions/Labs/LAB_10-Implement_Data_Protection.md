---
lab:
  title: 實驗室 10：實作資料保護
  module: Administer Data Protection
---

# 實驗 10 - 實作資料保護

## 實驗室簡介    

在此實驗室中，您將瞭解 Azure 虛擬機的備份和復原。 您將瞭解如何建立復原服務保存庫和 Azure 虛擬機的備份原則。 您將瞭解使用 Azure Site Recovery 進行災害復原。 

此實驗室需要 Azure 訂用帳戶。 您的訂用帳戶類型可能會影響此實驗室中功能的可用性。 您可以變更區域，但步驟是使用 **美國** 東部和美國 **西部**撰寫。

## 預估時間：50 分鐘

## 實驗案例

您的組織正在評估如何備份和還原 Azure 虛擬機，以避免意外或惡意數據遺失。 此外，組織想要探索使用 Azure Site Recovery 進行災害復原案例。 

## 互動式實驗室模擬

有一個互動式實驗室模擬，您可能會發現這個主題很有用。 模擬可讓您以自己的步調點選類似的案例。 互動式模擬和此實驗室之間有差異，但許多核心概念都相同。 不需要 Azure 訂用帳戶。

+ **[備份虛擬機和內部部署檔案。](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2016)**。 建立復原服務保存庫並實作 Azure 虛擬機備份。 使用 Microsoft Azure 復原服務代理程式實作內部部署檔案和資料夾備份。 內部部署備份超出此實驗室的範圍，但檢視這些步驟可能很有説明。 

## 作業技能

+ 工作 1：使用範本來布建基礎結構。
+ 工作 2：建立及設定復原服務保存庫。
+ 工作 3：設定 Azure 虛擬機層級備份。
+ 工作 4：監視 Azure 備份。
+ 工作 5：啟用虛擬機複寫。 

## 預估時間：40 分鐘

## 架構圖

![架構工作的圖表。](../media/az104-lab10-architecture.png)

## 工作 1：使用範本來布建基礎結構

在這項工作中，您將使用範本來部署虛擬機。 虛擬機將用來測試不同的備份案例。

1. **\\下載 Allfiles\\Lab10\\** 實驗室檔案。

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 `Deploy a custom template`。

1. 在自定義部署頁面上，選取 **[在編輯器**中建置您自己的範本]。

1. 在編輯範本頁面上，選取 **[載入檔案**]。

1. 找出並選取 **\\Allfiles\\Lab10\\az104-10-vms-edge-template.json** 檔案，然後選取 [ **開啟**]。

   >**注意：** 請花點時間檢閱範本。 我們正在部署虛擬網路和虛擬機，以便示範備份和復原。 

1. **儲存**您的變更。

1. 選取 [編輯參數 **]，然後**選取 **[載入檔案**]。

1. 載入並選取 **\\Allfiles\\Lab10\\az104-10-vms-edge-parameters.json** 檔案。

1. **儲存**您的變更。

1. 使用下列資訊來完成自訂部署欄位，讓所有其他欄位都保留預設值：

    | 設定       | 值         | 
    | ---           | ---           |
    | 訂用帳戶  | 您的 Azure 訂用帳戶 |
    | 資源群組| `az104-rg-region1`（如有必要，請選取**** 新增）
    | 區域        | **美國東部**   |
    | 使用者名稱      | **localadmin**   |
    | 密碼      | 提供複雜密碼 |

1. 選取 **[檢閱 + 建立]**,然後選取 **[建立]**。

    >**注意：** 等候範本部署，然後選取 **[移至資源**]。 您應該在一個虛擬網路中擁有一部虛擬機。 

## 工作 2：建立及設定復原服務保存庫

在這項工作中，您將建立復原服務保存庫。 復原服務保存庫提供虛擬機數據的記憶體。 

1. 在 Azure 入口網站 中，搜尋並選取 `Recovery Services vaults` ，然後在 [復原服務保存庫]** 刀鋒視窗上**，按兩下 **[+ 建立**]。

1. 在 [建立復原服務保存庫] 刀鋒視窗上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶 | Azure 訂用帳戶的名稱 |
    | 資源群組 | `az104-rg-region1`  |
    | 保存庫名稱 | `az104-rsv-region1` |
    | 區域 | **美國東部** |

    >**注意**：請確定指定與在上一項工作中部署虛擬機器的相同區域。

    ![復原服務保存庫的螢幕快照。](../media/az104-lab10-create-rsv.png)

1. 按兩下 [ **檢閱 + 建立**]，確定驗證通過，然後按兩下 [ **建立**]。

    >**注意**：等待部署完成。 部署應該需要幾分鐘的時間。 

1. 部署完成後，按一下 [前往資源]。

1. 在 [復原服務保存庫] 刀鋒視窗的 **[設定**] 區段中，按兩下 [**屬性**]。

1. 選取 [備份組態 **] 標籤底下的 **[**更新]** 連結。

1. 在 [**備份組態**] 刀鋒視窗中，檢閱 儲存體 複寫類型的**選擇**。 保留 [異地備援] 的預設設定，並關閉刀鋒視窗。

    >**注意**：此設定只有在無現有備份項目時才能設定。
    
    >**你知道嗎？** 跨區域還原選項讓您能夠在次要區域的 [Azure 配對區域](https://learn.microsoft.com/azure/backup/backup-create-recovery-services-vault#set-cross-region-restore)中還原資料。 

1. 返回 [復原服務保存庫] 刀鋒視窗，按兩下 **[安全性 設定 > 虛刪除和安全性設定**卷標底下的 **[更新**] 連結。

1. 請注意，在 [安全性設定] 刀鋒視窗上，針對在 Azure 中執行的工作負載，[虛刪除] 為 [啟用]。 請注意， **虛刪除保留期限** 為 **14** 天。 

1. 返回 [復原服務保存庫] 刀鋒窗口，選取 [ **概觀]** 刀鋒視窗。

>**你知道嗎？** Azure 有兩種類型的保存庫：復原服務保存庫和備份保存庫。 主要差異在於可以備份的數據源。 深入了解 [差異](https://learn.microsoft.com/answers/questions/405915/what-is-difference-between-recovery-services-vault)。

## 工作 3：設定 Azure 虛擬機層級備份

在此工作中，您將實作 Azure 虛擬機器層級備份。 在 VM 備份中，您必須定義適用於備份的備份和保留原則。 不同的 VM 可以指派不同的備份和保留原則。

   >**注意**：開始這項工作之前，請確定您在此實驗室第一個工作中起始的部署已成功完成。

1. 在 [復原服務保存庫] 刀鋒視窗上，按兩下 **[概觀**]，然後按兩下 [ **+ 備份**]。

1. 在 [備份目標] 刀鋒視窗上，指定以下設定：

    | 設定 | 值 |
    | --- | --- |
    | 您的工作負載在哪裡執行？ | **Azure** （請注意您的其他選項） |
    | 您要備份什麼內容？ | **虛擬機** （請注意您的其他選項 |

1. 選取 [備份]****。

1. 請注意，有兩 **種原則子類型**： **增強** 和 **標準**。 檢閱選項，然後選取 [ **標準**]。 

1. 在 [備份原則] 中 **，選取 **[建立新原則**]。**

1. 使用下列設定定義新的備份原則 (將其他設定保留預設值)：

    | 設定 | 值 |
    | ---- | ---- |
    | 原則名稱 | `az104-backup` |
    | 頻率 | **每日** |
    | 時間 | **上午 12:00** |
    | 時區 | 當地時區的名稱 |
    | 保留立即復原快照集 | **2** 天 |

    ![備份原則頁面的螢幕快照。](../media/az104-lab10-backup-policy.png)

1. 按一下 [確定] 以建立原則，然後在 [虛擬機器] 區段中，選取 [新增]。

1. 在 [**選取虛擬機]** 刀鋒視窗上，選取 **az-104-10-vm0**，單擊 [確定 **]，然後在 [備份]** 刀鋒視窗上**，按兩下 **[**啟用備份**]。

    >**注意**：請等候備份完成啟用。 這大約需要2分鐘的時間。

1. 在 [ **受保護的專案** ] 區段中，按兩下 **[備份專案**]，然後按兩下 **[Azure 虛擬機]** 專案。

1. 選取 az104-10-vm0 的 [**檢視詳細數據**] 連結，並檢視 [備份前檢查 **] 和 **[** 上次備份狀態**] 專案**的值。**

    >**注意：** 請注意備份擱置中。
    
1. 選取 **[立即**備份]，接受 [保留備份直到 **] 下拉式清單中的預設值**，然後按兩下 [**確定**]。

    >**注意**：不必等待備份完成，直接繼續進行下一個工作。

## 工作 4：監視 Azure 備份

在此工作中，您將部署 Azure 記憶體帳戶。 接著，您將設定保存庫，以將記錄和計量傳送至記憶體帳戶。 然後，此存放庫可以與Log Analytics或其他第三方監視解決方案搭配使用。

1. 從 Azure 入口網站 搜尋並選取 `Storage accounts`。

1. 在 [儲存體 帳戶] 頁面上，選取 [**建立**]。

1. 使用下列資訊來定義記憶體帳戶，然後選取 [ **檢閱**]。

    | 設定 | 值 |
    | --- | --- | 
    | 訂用帳戶          | *您的訂用帳戶*    |
    | 資源群組        | **az104-rg-region1**        |
    | 儲存體帳戶名稱  | 提供全域唯一的名稱   |
    | 區域                | **美國東部**   |

1. 在 [檢閱] 索引標籤上，選取 [ **建立**]。

    >**注意**：等待部署完成。 大約需要一分鐘的時間。

1. 搜尋並選取您的復原服務保存庫。

1. 選取 [診斷 設定 **]，然後選取 [**新增診斷設定**]。**

1. 將設定命名為 `Logs and Metrics to storage`。

1. 將複選標記放在下列記錄和計量類別旁：

    - **Azure 備份 報表數據**
    - **附加元件 Azure 備份 作業數據**
    - **附加元件 Azure 備份 警示數據**
    - **Azure Site Recovery 作業**
    - **Azure Site Recovery 事件**
    - **健全狀況**

1. 在 [目的地詳細數據] 中，將複選標記放在記憶體帳戶**的封存旁邊**。

1. 在 [儲存體 帳戶] 下拉式欄位中，選取您稍早在這項工作中部署的記憶體帳戶。

1. 選取 [儲存]。

1. 返回您的復原服務保存庫，在 [ **監視]** 刀鋒視窗中，選取 **[備份作業**]。

1. 找出 az104-10-vm0** 虛擬機的**備份作業。 

1. 檢閱備份作業的詳細數據。

## 工作 5：啟用虛擬機複寫

1. 在 Azure 入口網站 中，搜尋並選取 `Recovery Services vaults` ，然後在 [復原服務保存庫]** 刀鋒視窗上**，按兩下 **[+ 建立**]。

1. 在 [建立復原服務保存庫] 刀鋒視窗上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶 | Azure 訂用帳戶的名稱 |
    | 資源群組 | `az104-rg-region2`（如有必要，請選取**** 新增） |
    | 保存庫名稱 | `az104-rsv-region2` |
    | 區域 | **美國西部** |

    >**注意**：請確定您指定的 **區域與虛擬機不同** 。

1. 按兩下 [ **檢閱 + 建立**]，確定驗證通過，然後按兩下 [ **建立**]。

    >**注意**：等待部署完成。 部署應該需要幾分鐘的時間。 

1. 搜尋並選取 `az104-10-vm0` 虛擬機。

1. 在 [ **備份 + 災害復原** ] 刀鋒視窗中，選取 [ **災害復原**]。 

1. 選取 [啟用複寫]****。

1. 在 [ **基本] 索引** 標籤上 **，注意目標區域**。

1. 移至 [ **進階設定]** 索引標籤。已為您選取資源。 請務必檢閱它們。 

1. 確認您的訂用帳戶、vm 資源群組、虛擬網路和可用性（採用預設）設定。

1. 在 **儲存體 設定**中，選取 [**顯示詳細數據**]。

    | 設定 | 值 |
    | ---- | ---- |
    | VM 的變換 | **一般變換**  |
    | 快取儲存體帳戶 | **（新） xxx**  |

   >**注意：** 必須填入這兩個設定，否則驗證將會失敗。 如果值不存在，請嘗試重新整理頁面。 如果無法運作，請建立空的記憶體帳戶，然後返回此頁面。

1. 在 [復寫設定] 中 **，選取 [**顯示詳細數據**]。** 請注意，區域 2 中的復原資源保存庫已自動選取。

1. 選取 [ **檢閱 + 開始複寫** ]，然後 **選取 [啟用複寫**]。

    >**注意**：啟用復寫需要 10-15 分鐘的時間。 觀看入口網站右上方的通知訊息。 等候時，請考慮檢閱此頁面結尾的自我步調訓練連結。
    
1. 復寫完成後，請搜尋並找出您的復原服務保存庫 **az104-rsv-region2**。 您可能需要**重新整理**頁面。 

1. 在 [ **受保護的專案** ] 區段中，選取 [ **複寫的專案**]。

1. 檢查虛擬機是否顯示為複寫健康情況良好。 請注意，狀態會顯示同步處理狀態（從 0%） 開始，最後在初始同步處理完成之後顯示 **Protected** 。

   ![複寫項目頁面的螢幕快照。](../media/az104-lab10-replicated-items.png)

1. 選取虛擬機以檢視更多詳細數據。
   
>**你知道嗎？** 最好測試 [受保護 VM](https://learn.microsoft.com/azure/site-recovery/tutorial-dr-drill-azure#run-a-test-failover-for-a-single-vm) 的故障轉移。

## 清除您的資源

如果您使用自己的訂用 **帳戶** ，需要一分鐘的時間才能刪除實驗室資源。 這可確保資源可以釋出，並將成本降到最低。 刪除實驗室資源最簡單的方式是刪除實驗室資源群組。 

+ 在 Azure 入口網站 中，選取資源群組、選取 **[刪除資源群組**]、**輸入資源組名**，然後按兩下 [**刪除**]。
+ 使用 Azure PowerShell， `Remove-AzResourceGroup -Name resourceGroupName`。
+ 使用 CLI， `az group delete --name resourceGroupName`。

## 使用 Copilot 擴充學習
Copilot 可協助您瞭解如何使用 Azure 腳本工具。 Copilot 也可以協助實驗室中未涵蓋的區域，或您需要更多資訊的地方。 開啟 Edge 瀏覽器，然後選擇 [Copilot][右上方]，或流覽至 *[copilot.microsoft.com*]。 請花幾分鐘的時間嘗試這些提示。

+ Azure 備份 支援哪些產品？
+ 摘要說明使用 Azure 備份 備份和還原 Azure 虛擬機的步驟。
+ 如何使用 Azure PowerShell 或 CLI 來檢查 Azure 備份 作業的狀態。
+ 提供至少五個設定 Azure 虛擬機備份的最佳作法。  

## 透過自學型訓練深入了解

+ [使用 Azure 備份](https://learn.microsoft.com/training/modules/protect-virtual-machines-with-azure-backup/) 保護您的虛擬機。 使用 Azure 備份來協助保護內部部署伺服器、虛擬機器、SQL Server、Azure 檔案共用和其他工作負載。
+ [使用 Azure Site Recovery 來保護您的 Azure 基礎結構](https://learn.microsoft.com/en-us/training/modules/protect-infrastructure-with-site-recovery/)。 使用 Azure Site Recovery 自訂 Azure 虛擬機器的複寫、容錯移轉及容錯回復，藉以執行 Azure 基礎結構的災害復原。

## 重要心得

恭喜您完成實驗室。 以下是此實驗室的主要外賣。 

+ Azure 備份 服務提供簡單、安全且符合成本效益的解決方案來備份和復原您的數據。
+ Azure 備份 可以保護內部部署和雲端資源，包括虛擬機和檔案共用。
+ Azure 備份 原則會設定備份的頻率和恢復點的保留期間。 
+ Azure Site Recovery 是災害復原解決方案，可為虛擬機和應用程式提供保護。
+ Azure Site Recovery 會將工作負載復寫至次要月臺，並在發生中斷或災害時，故障轉移至次要月臺，並盡可能縮短停機時間繼續作業。
+ 復原服務保存庫會儲存備份數據，並將管理額外負荷降至最低。
