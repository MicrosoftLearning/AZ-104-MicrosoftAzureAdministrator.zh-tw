---
lab:
  title: 實驗室02a：管理訂用帳戶和 RBAC
  module: Administer Governance and Compliance
---

# 實驗 02a - 管理訂用帳戶與 RBAC

## 實驗室簡介

在此實驗室中，您將瞭解角色型訪問控制。 您將瞭解如何使用許可權和範圍來控制身分識別可以及無法執行的動作。 您也會瞭解如何使用管理群組讓訂用帳戶管理更容易。 

此實驗室需要 Azure 訂用帳戶。 您的訂用帳戶類型可能會影響此實驗室中功能的可用性。 您可以變更區域，但步驟是使用 **美國**東部撰寫。 

## 預估時間：30 分鐘

## 實驗案例

為了簡化組織中 Azure 資源的管理，您已負責實作下列功能：

- 建立包含所有 Azure 訂用帳戶的管理群組。

- 授與許可權，以提交管理群組中所有訂用帳戶的支援要求。 權限只能限制為： 

    - 建立和管理虛擬機器
    - 建立支援要求票證（不包括新增 Azure 提供者）


## 互動式實驗室模擬

您可能會發現一些互動式實驗室模擬對本主題很有用。 模擬可讓您以自己的步調點選類似的案例。 互動式模擬和此實驗室之間有差異，但許多核心概念都相同。 不需要 Azure 訂用帳戶。 

+ [使用 RBAC](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2014) 管理存取權。 將內建角色指派給使用者，並監視活動記錄。 

+ [管理訂用帳戶和 RBAC](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%202)。 實作管理群組並建立並指派自定義 RBAC 角色。

+ [開啟支援要求](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2022)。 檢閱支援方案選項，然後建立及監視支援要求、技術或計費。

## 架構圖

![實驗室工作的圖表。](../media/az104-lab02a-architecture.png)

## 作業技能

+ 工作 1：實作管理群組。
+ 工作 2：檢閱並指派內建的 Azure 角色。
+ 工作 3：建立自定義 RBAC 角色。
+ 工作 4：使用活動記錄監視角色指派。

## 工作 1：實作管理群組

在此工作中，您將建立及設定管理群組。 管理群組可用來以邏輯方式組織訂用帳戶。 訂用帳戶應進行區隔，並允許將 RBAC 和 Azure 原則 指派及繼承給其他管理群組和訂用帳戶。 例如，如果您的組織有歐洲的專用支援小組，您可以將歐洲訂用帳戶組織到管理群組，以提供支援人員對這些訂用帳戶的存取權（而不提供所有訂用帳戶的個別存取權）。 在我們的案例中，技術服務台的每個人都必須跨所有訂用帳戶建立支援要求。 

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 `Microsoft Entra ID`。

1. 在 [ **管理]** 刀鋒視窗中，選取 [ **屬性**]。

1. 檢閱 **Azure 資源** 區域的存取管理。 請確定您可以管理租使用者中所有 Azure 訂用帳戶和管理群組的存取權。
   
1. 搜尋並選取 `Management groups`。

1. 在 [管理群組] 刀鋒視窗上，按一下 [+ 建立]。

1. 使用下列設定建立管理群組。 完成時選取 [ **提交** ]。 

    | 設定 | 值 |
    | --- | --- |
    | 管理群組識別碼 | `az104-mg1` （目錄中必須是唯一的） |
    | 管理群組顯示名稱 | `az104-mg1` |

1. **重新整理** 管理群組頁面，以確保新的管理群組顯示。 這可能需要一分鐘的時間。 

   >**注意：** 您是否注意到根管理群組？ 根管理群組內建於階層中，讓所有管理群組和訂用帳戶都折疊在階層中。 此根管理群組允許在目錄層級套用全域原則和 Azure 角色指派。 建立管理群組之後，您會新增任何應該包含在群組中的訂用帳戶。 

## 工作 2：檢閱並指派內建 Azure 角色

在這項工作中，您將檢閱內建角色，並將 VM 參與者角色指派給技術支援中心的成員。 Azure 提供大量 [內建角色](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles)。 

1. **選取 az104-mg1** 管理群組。

1. 選取 [**訪問控制 （IAM）] 刀鋒視窗，然後選取 [**角色]**** 索引標籤。

1. 捲動可用的內建角色定義。 **檢視**角色以取得許可權 **、**JSON** 和**指派**的詳細資訊**。 您通常會使用 *擁有者*、 *參與者*和 *讀者*。 

1. **從下拉功能表中選取 [+ 新增**]，選取 [**新增角色指派**]。 

1. 在 [ **新增角色指派** ] 刀鋒視窗上，搜尋並選取 **[虛擬機參與者**]。 虛擬機參與者角色可讓您管理虛擬機，但無法存取其操作系統，或管理其連線的虛擬網路和記憶體帳戶。 這是技術支援中心的良好角色。 選取 [下一步]。

    >**你知道嗎？** Azure 原本只 **提供傳統** 部署模型。 這已由 **Azure Resource Manager** 部署模型取代。 最佳做法是不要使用傳統資源。 

1. 在 [成員]** 索引標籤上**，**選取 [成員**]。

    >**注意：** 下一個步驟會將角色指派給 **技術服務人員** 群組。 如果您沒有技術支援中心群組，請花一分鐘的時間加以建立。

1. 搜尋並選取 `helpdesk` 群組。 按一下 [選取]。 

1. 按兩下 [檢閱 + 指派]**** 以建立角色指派。

1. 在 [ **存取控制 （IAM）]** 刀鋒視窗上繼續。 在 [ **角色指派] 索引** 標籤上 **，確認技術服務人員** 群組具有 **虛擬機參與者** 角色。 

    >**注意：** 最佳做法一律將角色指派給非個人群組。 

    >**你知道嗎？** 此指派可能實際上不會授與您任何其他許可權。 如果您已經有擁有者角色，該角色會包含與 VM 參與者角色相關聯的所有許可權。
    
## 工作 3：建立自定義 RBAC 角色

在這項工作中，您將建立自定義 RBAC 角色。 自定義角色是實作環境最低許可權原則的核心部分。 內建角色對於您的案例可能擁有太多許可權。 在此工作中，我們將建立新的角色，並移除不需要的許可權。 您是否有管理重疊許可權的計劃？

1. 繼續處理您的管理群組。 在 [ **存取控制 （IAM）]** 刀鋒視窗中，選取 [ **檢查存取權** ] 索引卷標。

1. 在 [ **建立自定義角色** ] 方塊中，選取 [ **新增**]。

1. 在 [基本] 索引標籤上完成設定。

    | 設定 | 值 |
    | --- | --- |
    | 自訂角色名稱 | `Custom Support Request` |
    | 描述 | ''支援要求的自定義參與者角色。 |

1. 針對 [ **基準許可權**]，選取 [ **複製角色**]。 在 [ **要複製** 的角色] 下拉功能表中，選取 [ **支援要求參與者**]。

    ![複製角色的螢幕快照。](../media/az104-lab02a-clone-role.png)

1. 選取 **[下一步** ] 以移至 [ **許可權]** 索引卷標，然後選取 **[+ 排除許可權**]。

1. 在 [資源提供者搜尋] 字段中，輸入 `.Support` 並選取 **[Microsoft.Support**]。

1. 在許可權清單中，將複選框放在 [其他：註冊支持資源提供者 **] 旁**，然後選取 [**新增**]。 角色應更新為包含此許可權做為 *NotAction*。

    >**注意：** Azure 資源提供者是一組 REST 作業，可啟用特定 Azure 服務的功能。 我們不希望技術支援中心能夠擁有這項功能，因此它正從複製的角色中移除。 您也可以刪除，並將其他功能新增至新角色。 

1. 在 [ **可指派的範圍] 索引** 標籤上，確定您的管理群組已列出，然後按 [ **下一步**]。

1. 檢閱角色中自定義的 *Actions*、 *NotActions*和 *AssignableScopes* JSON。 

1. 選取 [檢閱 + 建立]，然後選取 [建立]。

    >**注意：** 此時，您已建立自定義角色，並將它指派給管理群組。  

## 工作 4：使用活動記錄監視角色指派

在這項工作中，您會檢視活動記錄檔，以判斷是否有人已建立新的角色。 

1. 在入口網站中 **，找出 az104-mg1** 資源，然後選取 [ **活動記錄**]。 活動記錄提供訂用帳戶層級事件的深入解析。 

1. 檢閱角色指派的啟用專案。 活動記錄可以篩選特定作業。 

    ![[活動記錄] 頁面的螢幕快照，其中已設定篩選。](../media/az104-lab02a-searchactivitylog.png)

## 清除您的資源

如果您使用自己的訂用 **帳戶** ，需要一分鐘的時間才能刪除實驗室資源。 這可確保資源可以釋出，並將成本降到最低。 刪除實驗室資源最簡單的方式是刪除實驗室資源群組。 

+ 在 Azure 入口網站 中，選取資源群組、選取 **[刪除資源群組**]、**輸入資源組名**，然後按兩下 [**刪除**]。
+ 使用 Azure PowerShell， `Remove-AzResourceGroup -Name resourceGroupName`。
+ 使用 CLI， `az group delete --name resourceGroupName`。
  
## 重要心得

恭喜您完成實驗室。 以下是此實驗室的主要外賣。 

+ 管理群組可用來以邏輯方式組織訂用帳戶。
+ 內建的根管理群組包含所有管理群組和訂用帳戶。
+ Azure 有許多內建角色。 您可以指派這些角色來控制資源的存取權。
+ 您可以建立新的角色或自定義現有的角色。
+ 角色會以 JSON 格式的檔案定義，並包含 *Actions*、 *NotActions* 和 *AssignableScopes*。
+ 您可以使用活動記錄檔來監視角色指派。 

## 透過自學型訓練深入了解

+ [使用 Azure 角色型存取控制（Azure RBAC）](https://learn.microsoft.com/training/modules/secure-azure-resources-with-rbac/)保護您的 Azure 資源。 使用 Azure RBAC 來管理 Azure 中資源的存取權。
+ [使用角色型訪問控制 （RBAC）](https://learn.microsoft.com/training/modules/create-custom-azure-roles-with-rbac/) 建立 Azure 資源的自定義角色。 了解存取控制之角色定義的結構。 識別能定義您自訂角色權限的要使用角色屬性。 建立 Azure 自訂角色並指派給使用者。





