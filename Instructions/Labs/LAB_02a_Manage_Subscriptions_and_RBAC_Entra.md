---
lab:
  title: 實驗室 02a：管理訂用帳戶與 RBAC
  module: Administer Governance and Compliance
---

# 實驗 02a - 管理訂用帳戶與 RBAC

## 實驗室簡介

在此實驗室中，您將了解角色型存取控制。 您將了解如何使用權限和範圍來控制身分識別可執行及無法執行的動作。 您也將了解如何使用管理群組讓訂用帳戶管理更為容易。 

此實驗室需要 Azure 訂用帳戶。 您的訂用帳戶類型可能會影響此實驗室中的功能可用性。 您可以變更區域，但這些步驟是使用**美國東部**作為區域來撰寫。 

## 預估時間：30 分鐘

## 實驗案例

為了簡化貴組織中 Azure 資源的管理，您已負責實作下列功能：

- 建立包含您所有 Azure 訂用帳戶的管理群組。

- 授與權限，以提交管理群組中所有訂用帳戶的支援要求。 這些權限應僅限於： 

    - 建立和管理虛擬機器
    - 建立支援要求票證 (不包括新增 Azure 提供者)


## 互動式實驗室模擬

您可能會發現一些互動式實驗室模擬對本主題十分有用。 模擬可讓您以自己的步調來點選類似的情節。 互動式模擬與此實驗室之間有所差異，但許多核心概念都相同。 不需要 Azure 訂用帳戶。 

+ [使用 RBAC 管理存取權](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2014)。 將內建角色指派給使用者，並監視活動記錄。 

+ [管理訂用帳戶與 RBAC](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%202)。 實作管理群組並建立及指派自訂 RBAC 角色。

+ [開啟支援要求](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2022)。 檢閱支援方案選項，然後建立及監視支援要求、技術或計費。

## 架構圖

![實驗室工作的圖表。](../media/az104-lab02a-architecture.png)

## 作業技能

+ 工作 1：實作管理群組。
+ 工作 2：檢閱並指派內建的 Azure 角色。
+ 工作 3：建立自訂 RBAC 角色。
+ 工作 4：使用 [活動記錄] 監視角色指派。

## 工作 1：實作管理群組

在此工作中，您將建立及設定管理群組。 管理群組可用來以邏輯方式組織和區隔訂用帳戶。 它們允許將 RBAC 和 Azure 原則 指派並繼承給其他管理群組和訂用帳戶。 例如，如果貴組織有專屬的歐洲支援小組，您可以將歐洲訂用帳戶組織到管理群組中，以提供支援人員對這些訂用帳戶的存取權 (而無需提供所有訂用帳戶的個別存取權)。 在我們的情節中，技術支援中心的每個人將需要建立跨所有訂用帳戶的支援要求。 

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 `Microsoft Entra ID`。

1. 在 [管理]**** 刀鋒視窗中，選取 [屬性]****。

1. 檢閱 [Azure 資源的存取管理]**** 區域。 請確定您可以管理租用戶中所有 Azure 訂用帳戶和管理群組的存取權。
   
1. 搜尋並選取 `Management groups`。

1. 在 [管理群組] 刀鋒視窗上，按一下 [+ 建立]。

1. 使用下列設定建立管理群組。 完成時，請選取 [提交]****。 

    | 設定 | 值 |
    | --- | --- |
    | 管理群組識別碼 | `az104-mg1` (在目錄中必須是唯一的) |
    | 管理群組顯示名稱 | `az104-mg1` |

1. **重新整理**管理群組頁面，以確保顯示新的管理群組。 這可能會需要一分鐘。 

   >**注意：** 您是否注意到根管理群組？ 這個根管理群組會建置於階層內，讓所有的管理群組和訂閱摺疊於其中。 這個根管理群組可讓全域原則和 Azure 角色指派在目錄層級套用。 建立管理群組之後，您會新增任何應該包含在群組中的訂用帳戶。 

## 工作 2：檢閱並指派內建的 Azure 角色

在這項工作中，您將檢閱內建角色，並將 [VM 參與者] 角色指派給 [技術支援中心] 的成員。 Azure 提供大量的[內建角色](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles)。 

1. 選取 [az104-mg1]**** 管理群組。

1. 選取 [存取控制 (IAM)]**** 刀鋒視窗，然後選取 [角色]**** 索引標籤。

1. 捲動瀏覽可用的內建角色定義。 **檢視**角色以取得 [權限]****、[JSON]**** 和 [指派]**** 的詳細資訊。 您通常會使用 [擁有者]**、[參與者]**，以及 [讀者]**。 

1. 從下拉式功能表中選取 [+ 新增]****，然後選取 [新增角色指派]****。 

1. 在 [新增角色指派]**** 刀鋒視窗上，搜尋並選取 [虛擬機器參與者]****。 虛擬機器參與者角色允許您管理虛擬機器，但不能存取其作業系統或管理其連線到的虛擬網路和儲存體帳戶。 這是很適合技術支援中心的角色。 選取 [下一步]。

    >**您知道嗎？** Azure 原本只提供**傳統**部署模型。 這已經由 **Azure Resource Manager** 部署模型取代。 最佳做法是不要使用傳統資源。 

1. 在 [成員]**** 索引標籤上，[選取成員]****。

    >**注意：** 下一個步驟會將角色指派給 [技術支援中心]**** 群組。 如果您沒有技術支援中心群組，請花點時間建立它。

1. 搜尋並選取 [`helpdesk`] 群組。 按一下 [選取]。 

1. 按兩下 [檢閱 + 指派]**** 以建立角色指派。

1. 在 [存取控制 (IAM)]**** 刀鋒視窗上繼續操作。 在 [角色指派]**** 索引標籤上，確認 [技術支援中心]**** 群組具有 [虛擬機器參與者]**** 角色。 

    >**注意：** 最佳做法是一律將角色指派給群組，而非指派給個人。 

    >**您知道嗎？** 此指派實際上可能不會授與您任何其他權限。 如果您已具備擁有者角色，該角色會包含與 VM 參與者角色相關聯的所有權限。
    
## 工作 3：建立自訂 RBAC 角色

在此工作中，您將建立自訂 RBAC 角色。 自訂角色是實作環境最低權限原則的核心部分。 針對您的情節，內建角色可能擁有太多權限。 我們也會建立新的角色，並移除不需要的許可權。 您是否有管理重疊權限的計劃？

1. 繼續處理您的管理群組。 在 [存取控制 (IAM)]**** 刀鋒視窗中，選取 [檢查存取權]**** 索引標籤。

1. 在 [建立自訂角色]**** 方塊中，選取 [新增]****。

1. 在 [基本] 索引標籤上完成設定。

    | 設定 | 值 |
    | --- | --- |
    | 自訂角色名稱 | `Custom Support Request` |
    | 描述 | `A custom contributor role for support requests.` |

1. 針對 [基準權限]****，選取 [複製角色]****。 在 [要複製的角色]**** 下拉式功能表中，選取 [支援要求參與者]****。

    ![複製角色的螢幕擷取畫面。](../media/az104-lab02a-clone-role.png)

1. 選取 [下一步]**** 以移至 [權限]**** 索引標籤，然後選取 [+ 排除權限]****。

1. 在 [資源提供者] 搜尋欄位中，輸入 `.Support`，然後選取 [Microsoft.Support]****。

1. 在權限清單中，選取 [其他：**註冊支援資源提供者]，然後選取 [新增]******。 角色應更新為將此權限納入為 *NotAction*。

    >**注意：** Azure 資源提供者是一組 REST 作業，可啟用特定 Azure 服務的功能。 我們不希望技術支援中心能夠擁有這項功能，因此它正從複製的角色中移除。 

1. 在 [可指派的範圍]**** 索引標籤上，確定您的管理群組已列出，然後按一下 [下一步]****。

1. 檢閱 *Actions*、*NotActions* 的 JSON，以及角色中自訂的 *AssignableScopes*。 

1. 選取 [檢閱 + 建立]，然後選取 [建立]。

    >**注意：** 此時，您已建立自訂角色，並將它指派給管理群組。  

## 工作 4：使用 [活動記錄] 監視角色指派

在此工作中，您會檢視活動記錄，以判斷是否有人已建立新的角色。 

1. 在入口網站中，找出 [az104-mg1]**** 資源，然後選取 [活動記錄]****。 活動記錄會提供訂用帳戶層級事件的深入解析。 

1. 檢閱角色指派的活動。 活動記錄可以針對特定作業來篩選。 

    ![已設定篩選器的 [活動記錄] 頁面的螢幕擷取畫面。](../media/az104-lab02a-searchactivitylog.png)

## 清除您的資源

如果您使用**自己的訂用帳戶**，請花點時間刪除實驗室資源。 如此可確保釋出資源，並將成本降到最低。 刪除實驗室資源的最簡單方式是刪除實驗室資源群組。 

+ 在 Azure 入口網站中，選取資源群組，選取 [刪除資源群組]****，[輸入資源群組名稱]****，然後按一下 [刪除]****。
+ 使用 Azure PowerShell `Remove-AzResourceGroup -Name resourceGroupName`。
+ 使用 CLI `az group delete --name resourceGroupName`。
  
## 利用 Copilot 延伸學習

Copilot 可協助您了解如何使用 Azure 指令碼工具。 Copilot 也可在實驗室中未涵蓋的區域或您需要更多資訊的地方提供協助。 開啟 Edge 瀏覽器，然後選擇 [Copilot] (右上方)，或瀏覽至 *copilot.microsoft.com*。 請花幾分鐘的時間嘗試下列提示。
+ 建立兩個將重要 PowerShell 和 CLI 命令醒目提示的資料表，以取得 Azure 上的組織訂用帳戶相關資訊，並在 [說明] 資料行中說明每個命令。 
+ Azure RBAC JSON 檔案的格式為何？
+ 建立自訂 Azure RBAC 角色的基本步驟為何？
+ Azure RBAC 角色與 Microsoft Entra ID 角色之間的差異為何？

## 透過自學型訓練深入了解

+ [使用 Azure 角色型存取控制 (Azure RBAC) 來保護 Azure 資源](https://learn.microsoft.com/training/modules/secure-azure-resources-with-rbac/)。 使用 Azure RBAC 管理 Azure 中的資源存取權。
+ [使用角色型存取控制 (RBAC) 為 Azure 資源建立自訂角色](https://learn.microsoft.com/training/modules/create-custom-azure-roles-with-rbac/)。 了解存取控制之角色定義的結構。 識別能定義您自訂角色權限的要使用角色屬性。 建立 Azure 自訂角色並指派給使用者。

## 重要心得

恭喜您完成此實驗室。 以下是此實驗室的主要重點。 

+ 管理群組可用來以邏輯方式組織訂用帳戶。
+ 內建的根管理群組包含所有管理群組和訂用帳戶。
+ Azure 有許多內建角色。 您可以指派這些角色來控制資源的存取權。
+ 您可以建立新的角色或自訂現有的角色。
+ 角色會以 JSON 格式的檔案定義，並包含 *Actions*、 *NotActions* 和 *AssignableScopes*。
+ 您可以使用 [活動記錄] 來監視角色指派。




