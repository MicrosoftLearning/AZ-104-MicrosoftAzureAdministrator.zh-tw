---
lab:
  title: 實驗室 07：管理 Azure 儲存體
  module: Administer Azure Storage
---

# 實驗室 07 - 管理 Azure 儲存體

## 實驗室簡介

在此實驗室中，您將瞭解如何建立 Azure Blob 和 Azure 檔案的儲存體帳戶。 您將瞭解如何設定及保護 Blob 容器。 您也會瞭解如何使用 儲存體 Browser 來設定及保護 Azure 檔案共用。 

此實驗室需要 Azure 訂用帳戶。 您的訂用帳戶類型可能會影響此實驗室中功能的可用性。 您可以變更區域，但步驟是使用美國東部撰寫。

## 預估時間：40 分鐘

## 實驗案例

您的組織目前正在內部部署資料存放區中儲存資料。 這些檔案大多不會經常存取。 您想要將不常存取的檔案放在較低價格的儲存層中，以將儲存體成本降到最低。 您也計畫探索 Azure 儲存體提供的不同保護機制，包括網路存取、驗證、授權和複寫。 最後，您想要判斷Azure 檔案儲存體適合裝載內部部署檔案共用的程度。

## 互動式實驗室模擬

您可能會發現互動式實驗室模擬對本主題很有用。 模擬可讓您以自己的步調點選類似的案例。 互動式模擬和此實驗室之間有差異，但許多核心概念都相同。 不需要 Azure 訂用帳戶。 

+ [建立 Blob 儲存體 ](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%205) 。 建立儲存體帳戶、管理 Blob 儲存體，以及監視儲存體活動。 
  
+ [管理 Azure 儲存體 ](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2011) 。 建立儲存體帳戶並檢閱設定。 管理 Blob 儲存體容器。 設定儲存體網路功能。 

## 架構圖

![工作的圖表。](../media/az104-lab07-architecture-diagram.png)

## 工作

+ 工作 1：建立和設定儲存體帳戶。 
+ 工作 2：建立及設定安全的 Blob 儲存體。
+ 工作 3：建立和設定安全的 Azure 檔案儲存體。

## 工作 1：建立及設定私人儲存體帳戶。 

在這項工作中，您將建立及設定儲存體帳戶。

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 ** [儲存體帳戶 ** ]，然後按一下 [ ** + 建立 ** ]。

1. 在 [建立儲存體帳戶 ** ] 刀鋒視窗的 ** [ ** 基本] 索引 ** 標籤上，指定下列設定（讓其他人保留預設值）：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶          | Azure 訂用帳戶的名稱  |
    | 資源群組        | **az104-rg7 ** （create new） |
    | 儲存體帳戶名稱  | 長度介於 3 到 24 個字元之間，由字母和數字組成的任何全域唯一名稱 |
    | 區域                | **美國東部**  |
    | 效能           | **標準 ** （請注意進階版選項） |
    | 備援性            | **異地備援儲存體 ** （請注意其他選項）|
    | 在區域可用性的情況下對資料進行讀取存取 | 核取方塊 |

1. 在 [ ** 進階 ** ] 索引標籤上，檢閱可用的選項，接受預設值。

1. 在 [ ** 網路] 索引 ** 標籤上，檢閱可用的選項，選取 [ ** 停用公用存取並使用私人存取]。 **

1. 檢閱 [ ** 資料保護 ** ] 索引標籤。注意 7 天是預設的虛刪除保留原則。 請注意，您可以啟用 Blob 版本控制。 接受預設值。

1. 檢閱 [ ** 加密] ** 索引標籤。請注意其他安全性選項。 接受預設值。

1. 選取 [ ** 檢閱 ** ]，等待驗證程式完成，然後按一下 [ ** 建立 ** ]。

1. 部署儲存體帳戶之後，請選取 ** [移至資源 ** ]。

1. 檢閱 [ ** 概觀] ** 刀鋒視窗和可變更的其他設定。 這些是儲存體帳戶的全域設定。 請注意，儲存體帳戶可用於 Blob 容器、檔案共用、佇列和資料表。

1. 在 [ ** 安全性 + 網路] 區 ** 段中，選取 [ ** 網路]。 ** 請注意，公用網路存取已停用。

+ 將 ** 公用存取層級 ** 變更為 ** [從選取的虛擬網路和 IP 位址 ** 啟用]。
+ 在 [ ** 防火牆] ** 區段中，核取 [新增用戶端 IP 位址] 的 ** 方塊。**
+ 請務必**儲存**您的變更。 
  
1. 在 [ ** 資料管理 ** ] 區段中，檢視 [ ** 備援] ** 刀鋒視窗。 請注意主要和次要資料中心位置的相關資訊。

1. 在 [資料管理] 區 ** 段中，選取 ** [生命週期管理 ** ]，然後選取 [ ** 新增規則 ** ]。 **

+ **將規則 `Movetocool` 命名 ** 為 。 請注意，限制規則範圍的選項。

+ 在 [ ** 基底 Blob] 索引標籤上 ** ， * 如果 * 上次修改了基底 Blob， `30 days` * 則 * ** 移至非經常性存取儲存體 ** 。

+ 請注意，您可以設定其他條件。 完成探索時，請選取 ** [新增 ** ]。

    ![移至非經常性存取規則條件的螢幕擷取畫面。](../media/az104-lab07-movetocool.png)

## 工作 2：管理 Blob 儲存體

在這項工作中，您將建立 Blob 容器並上傳 Blob。 Blob 容器是儲存非結構化資料的類似目錄結構。

### 建立 Blob 容器和以時間為基礎的保留原則

1. 繼續Azure 入口網站，使用您的儲存體帳戶。

1. 在 [資料儲存體]**** 區段中，按一下 [容器]****。 

1. 按一下 ** [+ 容器 ** ]，並使用 ** 下列設定建立 ** 容器：

    | 設定 | 值 |
    | --- | --- |
    | 名稱 | `data`  |
    | 公用存取層級 | 請注意，存取層級設定為私人 |

    ![建立容器的螢幕擷取畫面。](../media/az104-lab07-create-container.png)

1. 選取您的容器，然後在 ** [設定 ** ] 區段中，選取 [ ** 存取原則 ** ]。

1. 在 [ ** 固定 Blob 儲存體 ** ] 區域中，選取 [ ** 新增原則 ** ]。

    | 設定 | 值 |
    | --- | --- |
    | 原則類型 | **以時間為基礎的保留**  |
    | 設定的保留期間 | `180` 天 |

1. 選取 [儲存]。

### 管理 Blob 上傳

1. 返回容器頁面，選取您的資料 ** ** 容器，然後按一下 [ ** 上傳 ** ]。

1. 在 [ ** 上傳 Blob] ** 刀鋒視窗上，展開 [ ** 進階 ** ] 區段。

   >**注意 ** ：找出要上傳的檔案。 這可以是任何類型的檔案，但小型檔案是最好的。 

    | 設定 | 值 |
    | --- | --- |
    | 流覽檔案 | 新增您選取要上傳的檔案 |
    | Blob 類型 | **區塊 Blob** |
    | 區塊大小 | **4 MiB** |
    | 存取層 | **熱 **  （請注意其他選項） |
    | 上傳到資料夾 | `securitytest` |
    | 加密範圍 | 使用現有的預設容器範圍 |

    > **注意 ** ：您可以為個別 Blob 設定存取層。

1. 按一下 [上傳] 。

1. 確認您有新的資料夾，且您的檔案已上傳。 

1. 選取您的上傳檔案並檢閱選項，包括 ** 下載 ** 、 ** 刪除 ** 、 ** 變更層 ** 和 ** 取得租用 ** 。

1. 複製檔案 ** URL ** 並貼到新的 ** Inprivate ** 流覽視窗中。

1. 您應該會看到 XML 格式的訊息，指出 **ResourceNotFound** 或 **PublicAccessNotPermitted**。

    > **注意**：這是預期的結果，因為您建立的容器已將公用存取層級設定為 [私人 (無匿名存取)]。

### 設定 Blob 儲存體的有限存取

1. 返回上傳的檔案，然後選取 ** [產生 SAS ** ] 索引標籤。指定下列設定（讓其他人保留預設值）：

    | 設定 | 值 |
    | --- | --- |
    | 簽署金鑰 | **金鑰 1** |
    | 權限 | **讀取** |
    | 開始日期 | 昨天的日期 |
    | 開始時間 | 目前時間 |
    | 到期日 | 明天的日期 |
    | 過期時間 | 目前時間 |
    | 允許的 IP 位址 | 保留空白 |

1. 按一下 [產生 SAS 權杖與 URL]。

1. 按一下 [Blob SAS URL] 項目旁邊的 [複製至剪貼簿] 按鈕。

1. 使用 InPrivate 模式開啟另一個瀏覽器視窗，並瀏覽至您在上一個步驟中複製的 URL。

    > **注意 ** ：您應該能夠藉由下載檔案，並使用 記事本開啟它來檢視檔案的內容。 如果您收到 Windows SmartScreen 錯誤，請繼續前往頁面。

## 工作 5：建立和設定 Azure 檔案共用

在此工作中，您將建立和設定 Azure 檔案儲存體共用。 

### 建立檔案共用並上傳檔案

1. 在Azure 入口網站中，流覽回儲存體帳戶，在 ** [資料儲存體 ** ] 區段中，按一下 [ ** 檔案共用 ** ]。

1. 按一下 ** [+ 檔案共用 ** ]，然後在 [ ** 基本] 索引 ** 標籤上，為檔案共用提供名稱 。 `share1` 檢閱此索引標籤上的其他設定。 

1. 請注意階層 ** ** 選項。 保留預設 ** 交易優化 ** 。
   
1. 移至 [ ** 備份] ** 索引標籤，並確定 ** 未 ** 核取 [啟用備份 ** ** ]。 我們正在進行令人擷取的備份，以簡化實驗室設定。

1. 按一下 [ ** 檢閱 + 建立 ** ]，然後按一下 [ ** 建立 ** ]。 等候檔案共用部署。

    ![建立檔案共用頁面的螢幕擷取畫面。](../media/az104-lab07-create-share.png)

### 探索 儲存體 Browser 並上傳檔案

1. 返回您的儲存體帳戶，然後選取 ** [儲存體 Browser ** ]。 Azure 儲存體 Browser 是入口網站工具，可讓您快速檢視帳戶下的所有儲存體服務。

1. 選取 [ ** 檔案共用 ** ]，並確認您的 ** share1 ** 目錄存在。 請注意，您可以 ** + 新增目錄 ** 。

1. 選取您的 ** share1 ** 目錄，並注意您可以 ** + 新增目錄 ** 。 這可讓您建立資料夾結構。

1. **上傳 ** 您選擇的檔案。

1. 選取**上傳**。 流覽至您選擇的檔案，然後按一下 [ ** 上傳 ** ]。

    >**注意 ** ：您可以在 儲存體 Browser 中檢視檔案共用及管理這些共用。 目前沒有任何限制。

### 限制儲存體帳戶的網路存取

1. 在入口網站中，搜尋並選取 [虛擬網路]****。

1. 選取 **+ 建立**。 選取您的資源群組。 並提供虛擬網路 ** 的名稱 ** 。 `vnet1`

1. 取得其他參數的預設值，選取 [檢閱 + 建立 ** ]，然後 ** 選取 ** [建立 ** ]。

1. 等候資源部署，然後選取 ** [移至資源 ** ]。

1. 在 ** [設定] ** 區段中，選取 [ ** 子網] ** 刀鋒視窗。
    + **選取預設 ** 子網。
    + 在 [ ** 服務端點] ** 區段中，選擇 ** [服務 ** ] 下拉式清單中的 [Microsoft.儲存體 ** ** ]。
    + 請勿進行任何其他變更。    
    + 請務必**儲存**您的變更。 

1. 返回您的儲存體帳戶。

1. 在 [ ** 安全性 + 網路功能] ** 區段中，選取 [ ** 網路] ** 刀鋒視窗。

1. 選取 [新增現有的虛擬網路]，然後選取 ** [vnet1 ** ] 和 ** [預設 ** 子網]，選取 [ ** 新增 ** ]。

1. 在 [防火牆] ** 區 ** 段中， ** 刪除 ** 您的電腦 IP 位址。 允許的流量應該只來自虛擬網路。 

1. 請務必**儲存**您的變更。

    >**注意： ** 儲存體帳戶現在應該只能從您剛才建立的虛擬網路存取。 

1. 選取 ** 儲存體瀏覽器 ** 並 ** 重新 ** 整理頁面。 流覽至您的檔案共用或 Blob 內容。  

    >**注意： ** 您應該會收到未獲授權執行此作業 * 的訊息 * 。 您不是從虛擬網路連線。 這可能需要幾分鐘的時間才會生效。

## 重要心得

恭喜您完成實驗室。 以下是此實驗室的主要外賣。 

+ Azure 儲存體帳戶包含您所有Azure 儲存體資料物件：Blob、檔案、佇列和資料表。 儲存體帳戶會為 Azure 儲存體資料提供唯一的命名空間，可透過 HTTP 或 HTTPS 從世界各地存取該命名空間。
+ Azure 儲存體提供數個備援模型，包括本地備援儲存體（LRS）、區域備援儲存體（ZRS）和異地備援儲存體（GRS）。 
+ Azure Blob 儲存體可讓您在 Microsoft 的資料儲存體平臺上儲存大量的非結構化資料。 Blob 代表二進位大型物件，其包含影像和多媒體檔案等物件。
+ Azure 檔案儲存體提供結構化資料的共用儲存體。 資料可以組織在資料夾中。
+ 不可變儲存體可讓您以寫入一次、讀取多次 (WORM) 狀態來儲存資料。 不可變的儲存體原則為以時間為基礎或合法保存。


## 清除您的資源

如果您使用自己的訂用帳戶，需要一分鐘的時間才能刪除實驗室資源。 這可確保資源可以釋出，並將成本降到最低。 刪除實驗室資源最簡單的方式是刪除實驗室資源群組。 

+ 在Azure 入口網站中，選取資源群組、選取 ** [刪除資源群組 ** ]、 ** 輸入資源組名 ** ，然後按一下 [ ** 刪除 ** ]。

+ 使用 Azure PowerShell， `Remove-AzResourceGroup -Name resourceGroupName` 。

+ 使用 CLI， `az group delete --name resourceGroupName` 。
