---
lab:
  title: 實驗室 10：實作資料保護
  module: Administer Data Protection
---

# 實驗 10 - 實作資料保護

## 實驗室簡介    

在此實驗室中，您將瞭解 Azure 虛擬機器的備份和復原。 您將瞭解如何建立復原服務保存庫和 Azure 虛擬機器的備份原則。 您將瞭解使用 Azure Site Recovery 進行災害復原。 

此實驗室需要 Azure 訂用帳戶。 您的訂用帳戶類型可能會影響此實驗室中功能的可用性。 您可以變更區域，但步驟是使用 ** 美國 ** 東部和美國 ** 西部 ** 撰寫。

## 預估時間：40 分鐘

## 實驗案例

您的組織正在評估 Azure 復原服務，以備份和還原 Azure 虛擬機器。 組織想要識別保護資料免于意外或惡意資料遺失的方法。

## 互動式實驗室模擬

有一個互動式實驗室模擬，您可能會發現這個主題很有用。 模擬可讓您以自己的步調點選類似的案例。 互動式模擬和此實驗室之間有差異，但許多核心概念都相同。 不需要 Azure 訂用帳戶。

+ **[備份虛擬機器和內部部署檔案。 ](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%2016) ** 。 建立復原服務保存庫並實作 Azure 虛擬機器備份。 使用 Microsoft Azure 復原服務代理程式實作內部部署檔案和資料夾備份。 內部部署備份超出此實驗室的範圍，但檢視這些步驟可能很有説明。 

## 工作

+ 工作 1：佈建實驗環境
+ 工作 2：建立恢復服務保存庫
+ 工作 3：實作 Azure 虛擬機器層級備份
+ 工作 4：監視Azure 備份
+ 工作 5：為虛擬機器實作 Azure Site Recovery

## 預估時間：40 分鐘

## 架構圖

![架構工作的圖表。](../media/az104-lab10-architecture-diagram.png)

## 工作 1：佈建實驗室環境

在這項工作中，您將使用範本來部署虛擬機器。 虛擬機器將用來測試不同的備份案例。

1. 如有必要，請下載 ** \\ Allfiles \\ Labs \\ 10 \\ az104-10-vms-edge-template.json ** 實驗室檔案。

1. 登入 **Azure 入口網站** - `https://portal.azure.com`。

1. 搜尋並選取 `Deploy a custom template`。

1. 在自訂部署頁面上，選取 ** [在編輯器 ** 中建置您自己的範本]。

1. 在編輯範本頁面上，選取 ** [載入檔案 ** ]。

1. 找出並選取 ** \\ Allfiles \\ Lab10 \\ az104-10-vms-edge-template.json ** 檔案，然後選取 [ ** 開啟 ** ]。
2. 
   >**注意： ** 請花點時間檢閱範本。 正在部署多少部虛擬機器和虛擬網路？ 

1. 選取 [儲存]。
 
   >**注意： ** 請注意，此範本有許多系統管理員可以變更的參數。 

1. 使用下列資訊來完成自訂部署欄位，讓所有其他欄位都保留預設值：

    | 設定       | 值         | 
    | ---           | ---           |
    | 訂用帳戶  | 您的 Azure 訂用帳戶 |
    | 資源群組| `az104-rg10`（如有必要，請選取 **** 新建）
    | 區域        | **美國東部**   |
    | 使用者名稱      | `Student`   |
    | 密碼      | 提供複雜密碼 |

1. 選取 **[檢閱 + 建立]**,然後選取 **[建立]**。

    >**注意： ** 等候範本部署，然後選取 ** [移至資源 ** ]。 您應該在一個虛擬網路中擁有一部虛擬機器。 

## 工作 2：建立恢復服務保存庫

在這項工作中，您將建立復原服務保存庫。 復原服務保存庫提供 Azure 虛擬機器的備份資料。

1. 在Azure 入口網站中，搜尋並選取 `Recovery Services vaults` ，然後在 [復原服務保存庫] ** 刀鋒視窗上 ** ，按一下 ** [+ 建立 ** ]。

1. 在 [建立復原服務保存庫] 刀鋒視窗上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 訂用帳戶 | Azure 訂用帳戶的名稱 |
    | 資源群組 | **az104-rg10vault ** （如有必要，請選取 [新建] |
    | 保存庫名稱 | `az104-vault1` |
    | 區域 | **美國 ** 西部（或您在上一個工作中未使用的區域來部署 VM） |

    >**注意 ** ：請務必指定您在上一個工作中部署虛擬機器的不同區域。

    ![復原服務保存庫的螢幕擷取畫面。](../media/az104-lab10-create-rsv.png)

1. 按一下 [ ** 檢閱 + 建立 ** ]，確定驗證通過，然後按一下 [ ** 建立 ** ]。

    >**注意**：等待部署完成。 部署應該不到 1 分鐘便能完成。

1. 部署完成後，按一下 [前往資源]。

1. 在 ** [az104-vault1 ** Recovery Services 保存庫] 刀鋒視窗的 ** [設定 ** ] 區段中，按一下 ** [屬性 ** ]。

1. 在 ** az104-vault1 - [屬性] ** 刀鋒視窗上，按一下 ** [備份組態 ** ] 標籤下的 ** [更新] ** 連結。

1. 在 [ ** 備份組態 ** ] 刀鋒視窗中，檢閱儲存體複寫類型的 ** 選擇 ** 。 保留 [異地備援] 的預設設定，並關閉刀鋒視窗。

    >**注意**：此設定只有在無現有備份項目時才能設定。

1. **回到 az104-vault1 - [屬性] ** 刀鋒視窗，按一下 ** [安全性設定 ** 標籤下的 ** [更新 ** ] 連結。

1. 請注意，在 [安全性設定] 刀鋒視窗上，針對在 Azure 中執行的工作負載，[虛刪除] 為 [啟用]。

1. 關閉 [ ** 安全性設定] ** 刀鋒視窗，然後回到 ** az104-vault1 ** 復原服務保存庫刀鋒視窗上，按一下 ** [概觀 ** ]。

## 工作 3：實作 Azure 虛擬機器層級備份

在此工作中，您將實作 Azure 虛擬機器層級備份。 在 VM 備份中，您必須定義適用于備份的備份和保留原則。 不同的 VM 可以指派不同的備份和保留原則。

   >**注意**：開始這項工作之前，請確定您在此實驗室第一個工作中起始的部署已成功完成。

1. 在 ** [az104-vault1 ** 復原服務保存庫] 刀鋒視窗上，按一下 ** [概觀 ** ]，然後按一下 [ ** + 備份 ** ]。

1. 在 [備份目標] 刀鋒視窗上，指定以下設定：

    | 設定 | 值 |
    | --- | --- |
    | 您的工作負載在哪裡執行？ | **Azure ** （請注意您的其他選項） |
    | 您要備份什麼內容？ | **虛擬機器 ** （請注意您的其他選項 |

1. 在 [備份目標] 窗格上，按一下 [備份]。

1. 在 [備份原則] 上，檢閱 [DefaultPolicy] 設定，然後選取 [建立新原則]。

1. 使用下列設定定義新的備份原則 (將其他設定保留預設值)：

    | 設定 | 值 |
    | ---- | ---- |
    | 原則名稱 | `az104-policy` |
    | 頻率 | **每日** |
    | 時間 | **上午 12:00** |
    | 時區 | 當地時區的名稱 |
    | 保留立即復原快照集 | **2** 天 |

    ![備份原則頁面的螢幕擷取畫面。](../media/az104-lab10-backup-policy.png)

1. 按一下 [確定] 以建立原則，然後在 [虛擬機器] 區段中，選取 [新增]。

1. 在 [選取虛擬機器] 刀鋒視窗中，選取 [az-104-10-vm0]，按一下 [確定]，然後在 [備份] 刀鋒視窗上，按一下 [啟用備份]。

    >**注意**：請等候備份完成啟用。 這大約需要 2 分鐘的時間。

1. 流覽回 ** az104-vault1 ** 復原服務保存庫刀鋒視窗，在 ** [受保護的專案 ** ] 區段中，按一下 ** [備份專案 ** ]，然後按一下 ** [Azure 虛擬機器 ** ] 專案。

1. 在 [備份專案 (Azure 虛擬機器)] 刀鋒視窗上，選取 [az104-10-vm0] 的 [檢視詳細資料] 連結，並檢閱 [備份檢查前] 和 [上次備份狀態] 項目的值。

1. 在 [az104-10-vm0] 備份項目刀鋒視窗中，按一下 [立即備份]，接受 [保留備份到] 下拉式清單中的預設值，然後按一下 [確定]。

    >**注意**：不必等待備份完成，直接繼續進行下一個工作。

## 工作 4：監視Azure 備份

在此工作中，您將部署 Azure 儲存體帳戶。 接著，您將設定保存庫，以將記錄和計量傳送至儲存體帳戶。 然後，此存放庫可以與 Log Analytics 或其他協力廠商監視解決方案搭配使用。

1. 從Azure 入口網站搜尋並選取 `Storage accounts` 。

1. 在 [儲存體帳戶] 頁面上，選取 [ ** 建立 ** ]。

1. 使用下列資訊來定義儲存體帳戶，然後選取 [ ** 檢閱 ** ]。

    | 設定 | 值 |
    | --- | --- | 
    | 訂用帳戶          | *您的訂用帳戶*    |
    | 資源群組        | **az104-rg10**        |
    | 儲存體帳戶名稱  | 提供全域唯一的名稱，例如 * backupdiag1042024123*    |
    | 區域                | **美國 ** 東部（或您附近的區域）    |

1. 在 [檢閱] 索引標籤上，選取 [ ** 建立 ** ]。

    >**注意**：等待部署完成。 大約需要一分鐘的時間。

1. 流覽至 ** az104-vault1 ** 復原服務保存庫。

1. 在 ** az104-vault1 ** 頁面上，選取 [ ** 診斷設定 ** ]。

1. 在 [診斷設定] 頁面上，選取 [ ** 新增診斷設定 ** ]。

1. 在 [診斷設定] 頁面上，將設定 `Logs and Metrics to storage` 命名為 。

1. 將核取記號放在下列記錄檔和計量分類旁邊：

    - **Azure 備份報表資料**
    - **增益集Azure 備份作業資料**
    - **附加元件Azure 備份警示資料**
    - **Azure Site Recovery 作業**
    - **Azure Site Recovery 事件**
    - **健全狀況**

1. 在 [目的地詳細資料] 中，將核取記號放在儲存體帳戶 ** 的封存旁邊 ** 。

1. 在 [儲存體帳戶] 下拉式欄位中，選取您稍早在此工作中部署的儲存體帳戶。

1. 選取 [儲存]。

1. **返回 az104-vault1 ** 資源頁面。 

1. 在 az104-vault1 ** 上 ** ，選取 ** [備份作業 ** ]。

1. 找出 az104-10-vm0 ** VM 的 ** 備份作業，然後選取 [ ** 詳細資料]**

    >**注意 ** ：視螢幕解析度而定，您可能需要在備份作業資料表中向右捲動。

1. 檢閱您在 VM 上觸發的備份作業詳細資料。 備份作業的兩個子工作為何？


## 工作 5：實作 Azure Site Recovery

在這項工作中， 

1. 搜尋並選取您的復原服務保存庫 ** az104-vault1 ** 。

1. 從 [概 ** 觀] ** 刀鋒視窗中，選取 ** [+ 啟用 Site Recovery ** ]。

1. 檢閱您的選項，然後在 [Azure 虛擬機器 ** ] 區段中 ** 選取 ** [啟用複寫 ** ]。

1. 在 [ ** 來源] ** 索引標籤上，設定設定。

    | 設定 | 值 |
    | ---- | ---- |
    | 區域| **美國 ** 東部（閱讀有關相同區域中複寫的通知） |
    | 資源群組 | **az104-rg10** |
    | 虛擬機器部署模型 | **Resource Manager** |
    | 可用性區域之間的災害復原 | **否** |

1. 選取 ** [下一步 ** ]，然後在 [ ** 虛擬機器] ** 索引標籤上選取 ** az104-10-vm0 ** 。

1. 選取 ** [下一步 ** ] 並移至 [ ** 複寫設定 ** ] 索引標籤。請注意目標位置和容錯移轉網路資訊。 系統會自動建立這些資源。 採用預設值，然後選取 [ ** 下一步 ** ]。

1. 在 [ ** 管理] ** 索引標籤上，檢閱參數。

    | 設定 | 值 |
    | ---- | ---- |
    | 複寫原則 | **24 小時保留原則 ** （這可以從 0 變更為 15 天） |
    | 更新設定 | **允許 ASR 管理** |

1. 選取 [ ** 下一步 ** ]，然後 ** 選取 [啟用複寫 ** ]。

    >**注意 ** ：啟用複寫大約 15 分鐘。 觀看入口網站右上方的通知訊息。

1. 複寫完成後，請搜尋並找出您的復原服務保存庫 ** az104-vault1 ** 。

1. 在 [ ** 受保護的專案 ** ] 區段中，選取 [ ** 複寫的專案 ** ]。 檢查虛擬機器是否顯示為複寫健康情況良好。 請注意，狀態會顯示同步處理狀態（從 0%） 開始，最後在初始同步處理完成之後顯示 ** Protected ** 。 

    **你知道嗎？** 最好測試 [ 受保護 VM ](https://learn.microsoft.com/azure/site-recovery/tutorial-dr-drill-azure#run-a-test-failover-for-a-single-vm) 的容錯移轉。


## 重要心得

恭喜您完成實驗室。 以下是此實驗室的主要外賣。 

+ Azure 備份服務提供簡單、安全且符合成本效益的解決方案，以備份和復原您的資料。
+ Azure 備份可以保護內部部署和雲端資源，包括虛擬機器和檔案共用。
+ Azure 備份原則會設定備份的頻率和復原點的保留期間。 
+ Azure Site Recovery 是災害復原解決方案，可為虛擬機器和應用程式提供保護。
+ Azure Site Recovery 會將工作負載複寫至次要月臺，並在發生中斷或災害時，容錯移轉至次要月臺，並盡可能縮短停機時間繼續作業。
+ 復原服務保存庫會儲存備份資料，並將管理額外負荷降至最低。


## 清除您的資源

如果您使用自己的訂用帳戶，需要一分鐘的時間才能刪除實驗室資源。 這可確保資源可以釋出，並將成本降到最低。 刪除實驗室資源最簡單的方式是刪除實驗室資源群組。 

+ 在Azure 入口網站中，選取資源群組、選取 ** [刪除資源群組 ** ]、 ** 輸入資源組名 ** ，然後按一下 [ ** 刪除 ** ]。

+ 使用 Azure PowerShell， `Remove-AzResourceGroup -Name resourceGroupName` 。

+ 使用 CLI， `az group delete --name resourceGroupName` 。


